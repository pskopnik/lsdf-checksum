# End-to-End (E2E) Tester

The E2E Tester automates end-to-end tests of the checksum tool.
A file tree is generated and modified, including the simulation of corruption of some files.
The list of simulated corruptions is compared to the checksum warnings generated by the checksum tool.

See the `config.example.yaml` file for the available options.

```shell
$ go build .
# Ensure gentree (optional), chtree and lsdf-checksum-master binaries are available.
# Ensure (optional) that a reasonable gentree config file is specified.
# Ensure that a config file for the checksum master is specified.
# Start workers (in another terminal).
# Execute the E2E Tester on a full config:
$ ./e2e-tester config.yaml
```

Warnings:

 * This program may cause a significant volume of data to be generated through `gentree`.
   Specifying a `seed` in the `gentree` config is highly recommended, or `gentree` should be disabled in the config file.

 * This program may cause a significant amount of I/O load through `chtree`.

 * Intermediate results such as the list of changed files and checksum warnings are fully loaded into memory

## Workers

For the E2E Tester, an almost complete config file for the checksum master must be specified, so that the E2E Tester can perform master commands.

Checksum workers must already be available, meaning properly configured for this master config and running during the E2E Tester execution.

## Internals

### chtree Changers

The `change_likelihood` parameter in the config file specifies the likelihood of a non-corrupting change to a file.
This likelihood will be split to multiple `chtree` "changers".
Right now, there are two changers used for non-corrupting changes, "append" and "replace".
The calculation for the likelihood of both these changer is as follows:

```
(1-likelihood_per_changer)^2 = 1-change_likelihood
```

That means with a likelihood of `change_likelihood` at least one changer is applied on a file.
